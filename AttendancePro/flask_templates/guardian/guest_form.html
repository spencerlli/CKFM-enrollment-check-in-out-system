<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>CKFM Registration Form</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1"
    />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <link rel="stylesheet" href="../sdk/sdk.css" />
    <link rel="stylesheet" href="../sdk/helper.css" />
    <link rel="stylesheet" href="../sdk/iconfont.css" />
    <style>
      html,
      body,
      .app-wrapper {
        position: relative;
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div id="root" class="app-wrapper"></div>
    <script src=" ../sdk/sdk.js"></script>
    <script type="text/javascript">
      (function () {
        let amis = amisRequire('amis/embed');
        let amisJSON = {
          "type": "page",
          "toolbar": [
            {
              "type": "flex",
              "justify": "space-between",
              "className": "bg-light",
              "style": { "fontFamily": "Times New Roman" },
              "items": [
                {
                  "type": "button",
                  "icon": "fa-solid fa-house",
                  "className": "m-l-sm",
                  "actionType": "link",
                  "link": "{{url_for('index')}}"
                },
                {
                  "type": "button",
                  "label": "Sign out/退出账号",
                  "className": "m-r-md",
                  "level": "link",
                  "onEvent": {
                    "click": {
                      "actions": [
                        {
                          "actionType": "ajax",
                          "args": {
                            "api": {
                              "method": "post",
                              "url": "http://54.245.168.231:5002/logout"
                            }
                          }
                        },
                        {
                          "actionType": "link",
                          "expression": "typeof event.data.responseResult !== 'undefined' && event.data.responseResult.responseStatus === 0",
                          "args": {
                            "link": "{{url_for('login')}}"
                          }
                        }
                      ]
                    }
                  }
                }
              ]
            }
          ],


/*
===================================================================================================================================
========================================= Below: Content for mobile devices with narrow screen width ===============================
===================================================================================================================================
*/


          "mobile": {
            "body": [
              {
                "type": "tpl",
                "tpl": "<p style=\"text-align: center;\"><span style=\"font-family: 'times new roman', times, serif; font-size: 13pt;\"><strong><u>CKFM GUEST ENROLLMENT</u></strong></span></p>"
              },
              {
                "type": "wizard",
                "steps": [
                  {
                    "title": "Guardians",
                    "body": [
                      {
                        "type": "collapse",
                        "header": "Primary Guardian",
                        "headingClassName": "text-lg",
                        "body": [
                          {
                            "type": "collapse-group",
                            "activeKey": ["1", "2"],
                            "body": [
                              {
                                "type": "collapse",
                                "key": "1",
                                "header": "*Basic information",
                                "body": [
                                  {
                                    "type": "uuid",
                                    "name": "uuid"
                                  },
                                  {
                                    "type": "input-text",
                                    "label": "First Name:",
                                    "name": "fname",
                                    "required": true,
                                    "labelClassName": "text-xs"
                                  },
                                  {
                                    "type": "input-text",
                                    "label": "Last Name:",
                                    "name": "lname",
                                    "required": true,
                                    "labelClassName": "text-xs"
                                  },
                                  {
                                    "type": "input-text",
                                    "label": "Phone Number:",
                                    "name": "phone",
                                    "required": true,
                                    "labelClassName": "text-xs"
                                  },
                                  {
                                    "type": "select",
                                    "label": "Preferred Check-in/out Method",
                                    "name": "select",
                                    "value": "barcode",
                                    "required": true,
                                    "multiple": false,
                                    "labelClassName": "text-xs",
                                    "options": [
                                      // {
                                      //   "label": "Face ID",
                                      //   "value": "face"
                                      // },
                                      {
                                        "label": "Barcode",
                                        "value": "barcode"
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "type": "collapse",
                                "key": "2",
                                "header": "Face ID",
                                "body": [
                                  {
                                    "type": "iframe",
                                    "src": "../lib/webcam.html",
                                    "height": 510,
                                    "events": {
                                      "snap": {
                                        "actionType": "dialog",
                                        "dialog": {
                                          "title": "Do you want to keep this photo for your Face ID?",
                                          "body": {
                                            "type": "image",
                                            "height": "400px",
                                            "width": "350px",
                                            "name": "img"
                                          },
                                          "onEvent": {
                                            "confirm": {
                                              "weight": 0,
                                              "actions": [
                                                {
                                                  "actionType": "add",
                                                  "target": "guardian_images",
                                                  "payload": {
                                                    "img": "${img}"
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                ],
                                "visibleOn": "this.select == 'face'",
                                "headingClassName": "text-lg"
                              },
                              {
                                "type": "collapse",
                                "key": "3",
                                "disabled": true,
                                "className": "w-xxs",
                                "body": [
                                  {
                                    "type": "input-table",
                                    "name": "guardian_images",
                                    "columns": {
                                      "name": "img"
                                    }
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "combo",
                        "name": "guardians",
                        "multiple": true,
                        "placeholder": "",
                        "joinValues": true,
                        "mode": "normal",
                        "multiLine": true,
                        "addButtonText": "Enroll Another Guardian",
                        "deleteBtn": {
                          "type": "button",
                          "label": "delete",
                          "level": "danger",
                          "size": "xs",
                          "className": "m-t"
                        },
                        "items": [
                          {
                            "type": "collapse",
                            "header": "Guardian",
                            "headingClassName": "text-lg",
                            "body": [
                              {
                                "type": "collapse-group",
                                "activeKey": ["1", "2"],
                                "body": [
                                  {
                                    "type": "collapse",
                                    "key": "1",
                                    "active": true,
                                    "header": "*Basic information",
                                    "body": [
                                      {
                                        "type": "input-text",
                                        "label": "First Name:",
                                        "name": "fname",
                                        "required": true,
                                        "labelClassName": "text-xs"
                                      },
                                      {
                                        "type": "input-text",
                                        "label": "Last Name:",
                                        "name": "lname",
                                        "required": true,
                                        "labelClassName": "text-xs"
                                      },
                                      {
                                        "type": "input-text",
                                        "label": "Phone Number:",
                                        "name": "phone",
                                        "required": true,
                                        "labelClassName": "text-xs"
                                      },
                                      {
                                        "type": "select",
                                        "label": "Preferred Check-in/out Method",
                                        "name": "method",
                                        "value": "barcode",
                                        "required": true,
                                        "multiple": false,
                                        "labelClassName": "text-xs",
                                        "options": [
                                          // {
                                          //   "label": "Face ID",
                                          //   "value": "face"
                                          // },
                                          {
                                            "label": "Barcode",
                                            "value": "barcode"
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "type": "collapse",
                                    "key": "2",
                                    "header": "Face ID",
                                    "body": [
                                      {
                                        "type": "iframe",
                                        "src": "../lib/webcam.html",
                                        "height": 530
                                      }
                                    ],
                                    "visibleOn": "this.method == 'face'",
                                    "headingClassName": "text-lg"
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "title": "Students",
                    "body": [
                      {
                        "type": "collapse",
                        "header": "Student",
                        "headingClassName": "text-lg",
                        "body": [
                          {
                            "type": "collapse-group",
                            "activeKey": ["1", "2"],
                            "body": [
                              {
                                "type": "collapse",
                                "key": "1",
                                "header": "*Basic information",
                                "body": [
                                  {
                                    "type": "input-text",
                                    "label": "First Name:",
                                    "name": "s_fname",
                                    "required": true,
                                    "labelClassName": "text-xs"
                                  },
                                  {
                                    "type": "input-text",
                                    "label": "Last Name:",
                                    "name": "s_lname",
                                    "required": true,
                                    "labelClassName": "text-xs"
                                  },
                                  {
                                    "type": "select",
                                    "label": "Preferred Check-in/out Method",
                                    "name": "select2",
                                    "value": "barcode",
                                    "required": true,
                                    "multiple": false,
                                    "labelClassName": "text-xs",
                                    "options": [
                                      // {
                                      //   "label": "Face ID",
                                      //   "value": "face"
                                      // },
                                      {
                                        "label": "Barcode",
                                        "value": "barcode"
                                      }
                                    ]  
                                  }
                                ]
                              },
                              {
                                "type": "collapse",
                                "key": "2",
                                "header": "Face ID",
                                "body": [
                                  {
                                    "type": "iframe",
                                    "src": "../lib/webcam.html",
                                    "height": 510,
                                    "events": {
                                      "snap": {
                                        "actionType": "dialog",
                                        "dialog": {
                                          "title": "Do you want to keep this photo for your Face ID?",
                                          "body": {
                                            "type": "image",
                                            "height": "400px",
                                            "width": "350px",
                                            "name": "img"
                                          },
                                          "onEvent": {
                                            "confirm": {
                                              "weight": 0,
                                              "actions": [
                                                {
                                                  "actionType": "add",
                                                  "target": "student_images",
                                                  "payload": {
                                                    "img": "${img}"
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                ],
                                "visibleOn": "this.select2 == 'face'",
                                "headingClassName": "text-lg"
                              },
                              {
                                "type": "collapse",
                                "header": "Program",
                                "key": "3",
                                "body": [
                                  {
                                    "type": "matrix-checkboxes",
                                    "name": "program",
                                    "multiple": true,
                                    "columns": [
                                      {
                                        "label": "check"
                                      }
                                    ],
                                    "rows": [
                                      {
                                        "label": "SUNDAY SCHOOL 主日學 (18 months old – 6th grade) 10:00 AM – 11:30 AM Fee/ 免费"
                                      },
                                      {
                                        "label": "CM Parent and Child Lounge  中文堂家长和幼儿休息室 (新生兒 - 18個月大) July 2022 – June 2023 *Available on Sundays & Special events *主日和特別活動開放時可用"
                                      },
                                      {
                                        "label": "CANAAN KID’S CHOIR/ART 迦南兒童合唱團/ 美术班 (Kindergarten – 6th grade)  July 2022 – June. 2023 (Sunday 11:30 AM – 12:30 PM) Fee Required Program/ 需繳费活動: □ Early Bird / 1st Time Registration  $45  (June 2022 / 於6月間註冊) □ Regular Registration $60.00 August – Jan/於8-1月間註冊) □ Late Registration $30.00 (Feb – June /於2-6月間註冊)"
                                      },
                                      {
                                        "label": "U3 Friday Night (18 月大 – 3 歲)  Sept. 2021 – June 2022 周五晚7:30 PM – 9:30 PM *Class availability determines upon number of registrants *根據註冊人數決定是否開班"
                                      },
                                      {
                                        "label": "Friday Night CKFM Parent and Child Lounge  周五晚家长和幼儿休息室 (新生兒 - 18個月大) July 2022 – June 2023 7:30 PM – 9:30 PM"
                                      },
                                      {
                                        "label": "Friday Night   周五晚 (Preschool – 6th grades) July 2022 – June 2023  Friday 7:30 PM – 9:30 PM  Fee Required Program/需繳费活動  □ Early Bird / 1st Time Registration  $90  (June 2022) / 於6月份時註冊 □ Regular Registration $120.00 (July 2022 – Dec. 2022) 於7月至12月間註冊 □ Late Registration $60.00 (Jan. 2023 – June 2023) 於2023年1月至6月間註冊"
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "type": "collapse",
                                "key": "4",
                                "disabled": true,
                                "className": "w-xxs",
                                "body": [
                                  {
                                    "type": "input-table",
                                    "name": "student_images",
                                    "columns": {
                                      "name": "img"
                                    }
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "type": "combo",
                        "label": "",
                        "name": "students",
                        "multiple": true,
                        "placeholder": "",
                        "joinValues": true,
                        "addButtonText": "Enroll Another Student",
                        "mode": "normal",
                        "multiLine": true,
                        "deleteBtn": {
                          "type": "button",
                          "label": "delete",
                          "level": "danger",
                          "size": "xs",
                          "className": "m-t"
                        },
                        "items": [
                          {
                            "type": "collapse",
                            "header": "Student",
                            "headingClassName": "text-lg",
                            "body": [
                              {
                                "type": "collapse-group",
                                "activeKey": ["1", "2"],
                                "body": [
                                  {
                                    "type": "collapse",
                                    "key": "1",
                                    "active": true,
                                    "header": "*Basic information",
                                    "body": [
                                      {
                                        "type": "input-text",
                                        "label": "First Name:",
                                        "name": "fname",
                                        "required": true,
                                        "labelClassName": "text-xs"
                                      },
                                      {
                                        "type": "input-text",
                                        "label": "Last Name:",
                                        "name": "lname",
                                        "required": true,
                                        "labelClassName": "text-xs"
                                      },
                                      {
                                        "type": "select",
                                        "label": "Preferred Check-in/out Method",
                                        "name": "method",
                                        "value": "barcode",
                                        "required": true,
                                        "multiple": false,
                                        "labelClassName": "text-xs",
                                        "options": [
                                          // {
                                          //   "label": "Face ID",
                                          //   "value": "face"
                                          // },
                                          {
                                            "label": "Barcode",
                                            "value": "barcode"
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  {
                                    "type": "collapse",
                                    "key": "2",
                                    "header": "Face ID",
                                    "body": [
                                      {
                                        "type": "iframe",
                                        "src": "../lib/webcam.html",
                                        "height": 510
                                      }
                                    ],
                                    
                                    "visibleOn": "this.method == 'face'",
                                    "headingClassName": "text-lg"
                                  },
                                  {
                                    "type": "collapse",
                                    "header": "Program",
                                    "key": "3",
                                    "body": [
                                      {
                                        "type": "matrix-checkboxes",
                                        "name": "program",
                                        "multiple": true,
                                        "columns": [
                                          {
                                            "label": "check"
                                          }
                                        ],
                                        "rows": [
                                          {
                                            "label": "SUNDAY SCHOOL 主日學 (18 months old – 6th grade) 10:00 AM – 11:30 AM Fee/ 免费"
                                          },
                                          {
                                            "label": "CM Parent and Child Lounge  中文堂家长和幼儿休息室 (新生兒 - 18個月大) July 2022 – June 2023 *Available on Sundays & Special events *主日和特別活動開放時可用"
                                          },
                                          {
                                            "label": "CANAAN KID’S CHOIR/ART 迦南兒童合唱團/ 美术班 (Kindergarten – 6th grade)  July 2022 – June. 2023 (Sunday 11:30 AM – 12:30 PM) Fee Required Program/ 需繳费活動: □ Early Bird / 1st Time Registration  $45  (June 2022 / 於6月間註冊) □ Regular Registration $60.00 August – Jan/於8-1月間註冊) □ Late Registration $30.00 (Feb – June /於2-6月間註冊)"
                                          },
                                          {
                                            "label": "U3 Friday Night (18 月大 – 3 歲)  Sept. 2021 – June 2022 周五晚7:30 PM – 9:30 PM *Class availability determines upon number of registrants *根據註冊人數決定是否開班"
                                          },
                                          {
                                            "label": "Friday Night CKFM Parent and Child Lounge  周五晚家长和幼儿休息室 (新生兒 - 18個月大) July 2022 – June 2023 7:30 PM – 9:30 PM"
                                          },
                                          {
                                            "label": "Friday Night   周五晚 (Preschool – 6th grades) July 2022 – June 2023  Friday 7:30 PM – 9:30 PM  Fee Required Program/需繳费活動  □ Early Bird / 1st Time Registration  $90  (June 2022) / 於6月份時註冊 □ Regular Registration $120.00 (July 2022 – Dec. 2022) 於7月至12月間註冊 □ Late Registration $60.00 (Jan. 2023 – June 2023) 於2023年1月至6月間註冊"
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      }
                    ],
                    "mode": "normal" 
                  }
                ],
                "onEvent": {
                  "submitSucc": {
                    "weight": 0,
                    "actions": [
                      {
                        "actionType": "dialog",
                        "dialog": {
                          "title": "Success",
                          "showCloseButton": false,
                          "body": [
                            {
                              "type": "alert",
                              "title": "Thank You!",
                              "body": "Your enrollment has been received.",
                              "level": "success",
                              "showIcon": true
                            }
                          ],
                          "actions": [
                            {
                              "type": "button",
                              "label": "OK",
                              "actionType": "link",
                              "link": "{{url_for('index')}}",     // to index menu
                              "primary": true
                            }
                          ]
                        }
                      }
                    ]
                  }
                },
                "api": {
                  "method": "post",
                  "url": "",  // todo: save form api
                  requestAdaptor: function (api) {
                    function exist(p) {
                      if (typeof p === 'undefined') {
                        return false;
                      }
                      return true;
                    };

                    let primary = {merged: true};
                    let student = {merged: true};

                    primary.fname = api.data.fname;
                    delete api.data.fname;

                    primary.lname = api.data.lname;
                    delete api.data.lname;

                    if (exist(api.data.phone)) {
                      primary.phone = api.data.phone;
                      delete api.data.phone;
                    };

                    primary.method = api.data.select;
                    delete api.data.select;

                    if (exist(api.data.s_fname)) {
                      student.fname = api.data.s_fname;
                      delete api.data.s_fname;
                    };

                    if (exist(api.data.s_lname)) {
                      student.lname = api.data.s_lname;
                      delete api.data.s_lname;
                    };

                    if (exist(api.data.select2)) {
                      student.method = api.data.select2;
                      delete api.data.select2;
                    };

                    if (exist(api.data.program)) {
                      student.program = api.data.program;
                      delete api.data.program;
                    };

                    if (exist(api.data.guardians)) {
                      if (exist(api.data.guardians[0]) && 'merged' in api.data.guardians[0]) {
                        api.data.guardians[0] = primary;
                      } else {
                        api.data.guardians.unshift(primary);
                      };
                    } else {
                      api.data.guardians = [primary];
                    };

                    if (exist(api.data.students)) {
                      if (exist(api.data.students[0]) && 'merged' in api.data.students[0]) {
                        api.data.students[0] = student;
                      } else {
                        api.data.students.unshift(student);
                      };
                    } else {
                      api.data.students = [student];
                    };

                    return {...api};
                  }
                }
              }
            ]
          },


/*
===================================================================================================================================
========================================= Below: Content for desktops or laptops with wide screen ===================================
===================================================================================================================================
*/


          "body": [
            {
              "type": "tpl",
              "tpl": "<p style=\"text-align: center;\"><span style=\"font-family: 'times new roman', times, serif; font-size: 13pt;\"><strong><u>IRVINE CANAAN CHRISTIAN COMMUNITY CHURCH - CKFM GUEST ENROLLMENT</u></strong></span></p>"
            },
            {
              "type": "wizard",
              "steps": [
                {
                  "title": "Step 1 Guardian Enrollment",
                  "body": [
                    {
                      "type": "collapse",
                      "header": "Primary Guardian",
                      "headingClassName": "text-lg",
                      "body": [
                        {
                          "type": "collapse-group",
                          "activeKey": [
                            "1",
                            "2"
                          ],
                          "body": [
                            {
                              "type": "collapse",
                              "key": "1",
                              "active": true,
                              "header": "*Basic information",
                              "headingClassName": "text-lg",
                              "body": [
                                {
                                  "type": "grid",
                                  "columns": [
                                    {
                                      "body": [
                                        {
                                          "type": "uuid",
                                          "name": "uuid"
                                        },
                                        {
                                          "type": "input-text",
                                          "label": "First Name:",
                                          "name": "fname",
                                          "required": true,
                                          "mode": "horizontal"
                                        },
                                        {
                                          "type": "input-text",
                                          "label": "Last Name:",
                                          "name": "lname",
                                          "required": true,
                                          "mode": "horizontal",
                                        },
                                        {
                                          "type": "input-text",
                                          "label": "Phone Number:",
                                          "name": "phone",
                                          "required": true,
                                          "mode": "horizontal",
                                        }
                                      ],
                                      "valign": "top",
                                      "horizontal": {
                                        "justify": true
                                      },
                                      "columnClassName": "m-l-lg"
                                    },
                                    {
                                      "body": [
                                        {
                                          "type": "select",
                                          "label": "Preferred Check-in/out Method",
                                          "name": "select",
                                          "value": "barcode",
                                          "required": true,
                                          "multiple": false,
                                          "mode": "horizontal",
                                          "options": [
                                            // {
                                            //   "label": "Face ID",
                                            //   "value": "face"
                                            // },
                                            {
                                              "label": "Barcode",
                                              "value": "barcode"
                                            }
                                          ]
                                        }
                                      ],
                                      "horizontal": {
                                        "justify": true
                                      }
                                    }
                                  ] 
                                }
                              ]
                            },
                            {
                              "type": "collapse",
                              "key": "2",
                              "header": "Face ID",
                              "body": [
                                {
                                  "type": "iframe",
                                  "src": "../lib/webcam.html",
                                  "height": 510,
                                  "events": {
                                    "snap": {
                                      "actionType": "dialog",
                                      "dialog": {
                                        "title": "Do you want to keep this photo for your Face ID?",
                                        "body": {
                                          "type": "image",
                                          "height": "400px",
                                          "width": "350px",
                                          "name": "img"
                                        },
                                        "onEvent": {
                                          "confirm": {
                                            "weight": 0,
                                            "actions": [
                                              {
                                                "actionType": "add",
                                                "target": "guardian_images",
                                                "payload": {
                                                  "img": "${img}"
                                                }
                                              }
                                            ]
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              ],
                              "visibleOn": "this.select == 'face'",
                              "headingClassName": "text-lg"
                            },
                            {
                              "type": "collapse",
                              "key": "3",
                              "disabled": true,
                              "className": "w-xxs",
                              "body": [
                                {
                                  "type": "input-table",
                                  "name": "guardian_images",
                                  "columns": {
                                    "name": "img"
                                  }
                                }
                              ]
                            }
                          ],
                          "className": "m-l"
                        }
                      ]
                    },
                    {
                      "type": "combo",
                      "name": "guardians",
                      "multiple": true,
                      "items": [
                        {
                          "type": "container",
                          "body": [
                            {
                              "type": "divider"
                            },
                            {
                              "type": "collapse",
                              "header": "Guardian",
                              "headingClassName": "text-lg",
                              "body": [
                                {
                                  "type": "collapse-group",
                                  "activeKey": ["1", "2"],
                                  "className": "m-l",
                                  "body": [
                                    {
                                      "type": "collapse",
                                      "key": "1",
                                      "active": true,
                                      "header": "*Basic information",
                                      "body": [
                                        {
                                          "type": "grid",
                                          "columns": [
                                            {
                                              "body": [
                                              {
                                                  "type": "input-text",
                                                  "label": "First Name:",
                                                  "name": "fname",
                                                  "required": true,
                                                  "mode": "horizontal"
                                                },
                                                {
                                                  "type": "input-text",
                                                  "label": "Last Name:",
                                                  "name": "lname",
                                                  "required": true,
                                                  "mode": "horizontal"
                                                },
                                                {
                                                  "type": "input-text",
                                                  "label": "Phone Number:",
                                                  "name": "phone",
                                                  "required": true,
                                                  "mode": "horizontal"
                                                }
                                              ],
                                              "valign": "middle",
                                              "horizontal": {
                                                "justify": true
                                              },
                                              "columnClassName": "m-l-lg"
                                            },
                                            {
                                              "body": [
                                                {
                                                  "type": "select",
                                                  "label": "Preferred Check-in/out Method",
                                                  "name": "method",
                                                  "value": "barcode",
                                                  "required": true,
                                                  "multiple": false,
                                                  "mode": "horizontal",
                                                  "options": [
                                                    // {
                                                    //   "label": "Face ID",
                                                    //   "value": "face"
                                                    // },
                                                    {
                                                      "label": "Barcode",
                                                      "value": "barcode"
                                                    }
                                                  ]
                                                }
                                              ],
                                              "horizontal": {
                                                "justify": true
                                              }
                                            }
                                          ]
                                        }
                                      ],
                                      "headingClassName": "text-lg"
                                    },
                                    {
                                      "type": "collapse",
                                      "key": "2",
                                      "header": "Face ID",
                                      "body": [
                                        {
                                          "type": "iframe",
                                          "src": "../lib/webcam.html",
                                          "height": 530
                                        }
                                      ],
                                      "visibleOn": "this.method == 'face'",
                                      "headingClassName": "text-lg"
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ],
                      "placeholder": "",
                      "joinValues": true,
                      "addButtonText": "Enroll Another Guardian",
                      "messages": {
                      },
                      "deleteBtn": {
                        "type": "button",
                        "label": "delete",
                        "level": "danger",
                        "className": "m-t-lg"
                      },
                      "mode": "normal",
                      "multiLine": false
                    }
                  ]
                },
                {
                  "title": "Step 2 Student Enrollment",
                  "body": [
                    {
                      "type": "collapse",
                      "header": "Student",
                      "headingClassName": "text-lg",
                      "body": [
                        {
                          "type": "collapse-group",
                          "activeKey": ["1", "2", "3"],
                          "className": "m-l",
                          "body": [
                            {
                              "type": "collapse",
                              "key": "1",
                              "header": "*Basic information",
                              "headingClassName": "text-lg",
                              "body": [
                                {
                                  "type": "grid",
                                  "columns": [
                                    {
                                      "body": [
                                      {
                                          "type": "input-text",
                                          "label": "First Name:",
                                          "name": "s_fname",
                                          "required": true,
                                          "mode": "horizontal"
                                        },
                                        {
                                          "type": "input-text",
                                          "label": "Last Name:",
                                          "name": "s_lname",
                                          "required": true,
                                          "mode": "horizontal"
                                        }
                                      ],
                                      "valign": "top",
                                      "md": "",
                                      "columnClassName": "m-l-lg",
                                      "horizontal": {
                                        "justify": true
                                      }
                                    },
                                    {
                                      "body": [
                                        {
                                          "type": "select",
                                          "label": "Preferred Check-in/out Method",
                                          "name": "select2",
                                          "value": "barcode",
                                          "required": true,
                                          "multiple": false,
                                          "mode": "horizontal",
                                          "options": [
                                            // {
                                            //   "label": "Face ID",
                                            //   "value": "face"
                                            // },
                                            {
                                              "label": "Barcode",
                                              "value": "barcode"
                                            }
                                          ]  
                                        }
                                      ],
                                      "horizontal": {
                                        "justify": true
                                      }
                                    }
                                  ]
                                }
                              ]
                            },
                            {
                              "type": "collapse",
                              "key": "2",
                              "header": "Face ID",
                              "body": [
                                {
                                  "type": "iframe",
                                  "src": "../lib/webcam.html",
                                  "height": 510,
                                  "events": {
                                    "snap": {
                                      "actionType": "dialog",
                                      "dialog": {
                                        "title": "Do you want to keep this photo for your Face ID?",
                                        "body": {
                                          "type": "image",
                                          "height": "400px",
                                          "width": "350px",
                                          "name": "img"
                                        },
                                        "onEvent": {
                                          "confirm": {
                                            "weight": 0,
                                            "actions": [
                                              {
                                                "actionType": "add",
                                                "target": "student_images",
                                                "payload": {
                                                  "img": "${img}"
                                                }
                                              }
                                            ]
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              ],
                              "visibleOn": "this.select2 == 'face'",
                              "headingClassName": "text-lg"
                            },
                            {
                              "type": "collapse",
                              "header": "Program",
                              "body": [
                                {
                                  "type": "matrix-checkboxes",
                                  "name": "program",
                                  "multiple": true,
                                  "columns": [
                                    {
                                      "label": "check"
                                    }
                                  ],
                                  "rows": [
                                    {
                                      "label": "SUNDAY SCHOOL 主日學 (18 months old – 6th grade) 10:00 AM – 11:30 AM Fee/ 免费"
                                    },
                                    {
                                      "label": "CM Parent and Child Lounge  中文堂家长和幼儿休息室 (新生兒 - 18個月大) July 2022 – June 2023 *Available on Sundays & Special events *主日和特別活動開放時可用"
                                    },
                                    {
                                      "label": "CANAAN KID’S CHOIR/ART 迦南兒童合唱團/ 美术班 (Kindergarten – 6th grade)  July 2022 – June. 2023 (Sunday 11:30 AM – 12:30 PM) Fee Required Program/ 需繳费活動: □ Early Bird / 1st Time Registration  $45  (June 2022 / 於6月間註冊) □ Regular Registration $60.00 August – Jan/於8-1月間註冊) □ Late Registration $30.00 (Feb – June /於2-6月間註冊)"
                                    },
                                    {
                                      "label": "U3 Friday Night (18 月大 – 3 歲)  Sept. 2021 – June 2022 周五晚7:30 PM – 9:30 PM *Class availability determines upon number of registrants *根據註冊人數決定是否開班"
                                    },
                                    {
                                      "label": "Friday Night CKFM Parent and Child Lounge  周五晚家长和幼儿休息室 (新生兒 - 18個月大) July 2022 – June 2023 7:30 PM – 9:30 PM"
                                    },
                                    {
                                      "label": "Friday Night   周五晚 (Preschool – 6th grades) July 2022 – June 2023  Friday 7:30 PM – 9:30 PM  Fee Required Program/需繳费活動  □ Early Bird / 1st Time Registration  $90  (June 2022) / 於6月份時註冊 □ Regular Registration $120.00 (July 2022 – Dec. 2022) 於7月至12月間註冊 □ Late Registration $60.00 (Jan. 2023 – June 2023) 於2023年1月至6月間註冊"
                                    }
                                  ]
                                }
                              ],
                              "key": "3",
                              "headingClassName": "text-lg"
                            },
                            {
                              "type": "collapse",
                              "key": "4",
                              "disabled": true,
                              "className": "w-xxs",
                              "body": [
                                {
                                  "type": "input-table",
                                  "name": "student_images",
                                  "columns": {
                                    "name": "img"
                                  }
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "type": "combo",
                      "label": "",
                      "name": "students",
                      "multiple": true,
                      "placeholder": "",
                      "joinValues": true,
                      "addButtonText": "Enroll Another Student",
                      "deleteBtn": {
                        "type": "button",
                        "label": "delete",
                        "level": "danger",
                        "className": "m-t-lg"
                      },
                      "mode": "normal",
                      "multiLine": false,
                      "items": [
                        {
                          "type": "container",
                          "body": [
                            {
                              "type": "divider"
                            },
                            {
                              "type": "collapse",
                              "header": "Student",
                              "headingClassName": "text-lg",
                              "body": [
                                {
                                  "type": "collapse-group",
                                  "activeKey": ["1", "2", "3"],
                                  "className": "m-l",
                                  "body": [
                                    {
                                      "type": "collapse",
                                      "key": "1",
                                      "active": true,
                                      "header": "*Basic information",
                                      "": "u:3c6aca3d43c1",
                                      "body": [
                                        {
                                          "type": "grid",
                                          "columns": [
                                            {
                                              "body": [
                                                {
                                                  "type": "input-text",
                                                  "label": "First Name:",
                                                  "name": "fname",
                                                  "required": true,
                                                  "mode": "horizontal"
                                                },
                                                {
                                                  "type": "input-text",
                                                  "label": "Last Name:",
                                                  "name": "lname",
                                                  "required": true,
                                                  "mode": "horizontal"
                                                }
                                              ],
                                              "valign": "top",
                                              "columnClassName": "m-l-lg",
                                              "horizontal": {
                                                "justify": true
                                              }
                                            },
                                            {
                                              "body": [
                                                {
                                                  "type": "select",
                                                  "label": "Preferred Check-in/out Method",
                                                  "name": "method",
                                                  "value": "barcode",
                                                  "required": true,
                                                  "multiple": false,
                                                  "mode": "horizontal",
                                                  "options": [
                                                    // {
                                                    //   "label": "Face ID",
                                                    //   "value": "face"
                                                    // },
                                                    {
                                                      "label": "Barcode",
                                                      "value": "barcode"
                                                    }
                                                  ]
                                                }
                                              ],
                                              "horizontal": {
                                                "justify": true
                                              }
                                            }
                                          ]
                                        }
                                      ],
                                      "headingClassName": "text-lg"
                                    },
                                    {
                                      "type": "collapse",
                                      "key": "2",
                                      "header": "Face ID",
                                      "body": [
                                        {
                                          "type": "iframe",
                                          "src": "../lib/webcam.html",
                                          "height": 510
                                        }
                                      ],
                                      
                                      "visibleOn": "this.method == 'face'",
                                      "headingClassName": "text-lg"
                                    },
                                    {
                                      "type": "collapse",
                                      "header": "Program",
                                      "body": [
                                        {
                                          "type": "matrix-checkboxes",
                                          "name": "program",
                                          "multiple": true,
                                          "columns": [
                                            {
                                              "label": "check"
                                            }
                                          ],
                                          "rows": [
                                            {
                                              "label": "SUNDAY SCHOOL 主日學 (18 months old – 6th grade) 10:00 AM – 11:30 AM Fee/ 免费"
                                            },
                                            {
                                              "label": "CM Parent and Child Lounge  中文堂家长和幼儿休息室 (新生兒 - 18個月大) July 2022 – June 2023 *Available on Sundays & Special events *主日和特別活動開放時可用"
                                            },
                                            {
                                              "label": "CANAAN KID’S CHOIR/ART 迦南兒童合唱團/ 美术班 (Kindergarten – 6th grade)  July 2022 – June. 2023 (Sunday 11:30 AM – 12:30 PM) Fee Required Program/ 需繳费活動: □ Early Bird / 1st Time Registration  $45  (June 2022 / 於6月間註冊) □ Regular Registration $60.00 August – Jan/於8-1月間註冊) □ Late Registration $30.00 (Feb – June /於2-6月間註冊)"
                                            },
                                            {
                                              "label": "U3 Friday Night (18 月大 – 3 歲)  Sept. 2021 – June 2022 周五晚7:30 PM – 9:30 PM *Class availability determines upon number of registrants *根據註冊人數決定是否開班"
                                            },
                                            {
                                              "label": "Friday Night CKFM Parent and Child Lounge  周五晚家长和幼儿休息室 (新生兒 - 18個月大) July 2022 – June 2023 7:30 PM – 9:30 PM"
                                            },
                                            {
                                              "label": "Friday Night   周五晚 (Preschool – 6th grades) July 2022 – June 2023  Friday 7:30 PM – 9:30 PM  Fee Required Program/需繳费活動  □ Early Bird / 1st Time Registration  $90  (June 2022) / 於6月份時註冊 □ Regular Registration $120.00 (July 2022 – Dec. 2022) 於7月至12月間註冊 □ Late Registration $60.00 (Jan. 2023 – June 2023) 於2023年1月至6月間註冊"
                                            }
                                          ]
                                        }
                                      ],
                                      "key": "3",
                                      "headingClassName": "text-lg"
                                    }
                                  ] 
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ] 
                }
              ],
              "mode": "horizontal",
              "onEvent": {
                "submitSucc": {
                  "weight": 0,
                  "actions": [
                    {
                      "actionType": "dialog",
                      "dialog": {
                        "title": "Success",
                        "showCloseButton": false,
                        "body": [
                          {
                            "type": "alert",
                            "title": "Thank You!",
                            "body": "Your enrollment has been received.",
                            "level": "success",
                            "showIcon": true
                          }
                        ],
                        "actions": [
                          {
                            "type": "button",
                            "label": "OK",
                            "actionType": "link",
                            "link": "{{url_for('index')}}",     // to index menu
                            "primary": true
                          }
                        ]
                      }
                    }
                  ]
                }
              },
              "api": {
                "method": "post",
                "url": "",  // todo: save form api
                requestAdaptor: function (api) {
                  function exist(p) {
                    if (typeof p === 'undefined') {
                      return false;
                    }
                    return true;
                  };

                  let primary = {merged: true};
                  let student = {merged: true};

                  primary.fname = api.data.fname;
                  delete api.data.fname;

                  primary.lname = api.data.lname;
                  delete api.data.lname;

                  if (exist(api.data.phone)) {
                    primary.phone = api.data.phone;
                    delete api.data.phone;
                  };

                  primary.method = api.data.select;
                  delete api.data.select;

                  if (exist(api.data.s_fname)) {
                    student.fname = api.data.s_fname;
                    delete api.data.s_fname;
                  };

                  if (exist(api.data.s_lname)) {
                    student.lname = api.data.s_lname;
                    delete api.data.s_lname;
                  };

                  if (exist(api.data.select2)) {
                    student.method = api.data.select2;
                    delete api.data.select2;
                  };

                  if (exist(api.data.program)) {
                    student.program = api.data.program;
                    delete api.data.program;
                  };

                  if (exist(api.data.guardians)) {
                    if (exist(api.data.guardians[0]) && 'merged' in api.data.guardians[0]) {
                      api.data.guardians[0] = primary;
                    } else {
                      api.data.guardians.unshift(primary);
                    };
                  } else {
                    api.data.guardians = [primary];
                  };

                  if (exist(api.data.students)) {
                    if (exist(api.data.students[0]) && 'merged' in api.data.students[0]) {
                      api.data.students[0] = student;
                    } else {
                      api.data.students.unshift(student);
                    };
                  } else {
                    api.data.students = [student];
                  };

                  return {...api};
                }
              },
              "className": "m-r m-l"
            }
          ] 
        };
        let amisScoped = amis.embed('#root', amisJSON, {locale: 'en-US'});
      })();
    </script>
  </body>
</html>