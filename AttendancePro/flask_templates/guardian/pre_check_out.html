{% extends "layout.html" %}
{% block title %}Pre-check-out{% endblock %}

{% block body %}
{
  "type": "crud",
  "api": "{{url_for('preCheckOut')}}",
  "mode": "cards",
  "card": {
    "header": {
      "title": "${fname} ${lname}",
      "subTitle": "${CAPITALIZE(object)}",
      "avatarText": "${fname|first|upperCase}",
      "avatarTextBackground": ["#04c1ba", "#108cee"]
    }
  },
  "headerToolbar": ["*Note: Please select only one guardian and at least one student to pre-check out."],
  "footerToolbar": ["bulkActions"],
  "bulkActions": [
    {
      "type": "button",
      "label": "Pre-check out",
      "level": "primary",
      "disabledOn": "this.selectedItems.filter(item => item.object === 'guardian').length != 1 || !this.selectedItems.some(item => item.object === 'student')",
      "onEvent": {
        "click": {
          "actions": [
            {
              "actionType": "ajax",
              "args": {
                "api": {
                  "method": "post",
                  "url": "{{url_for('preCheckOut')}}",
                  "data": {
                    "items": "${selectedItems}"
                  }
                }
              }
            },
            {
              "actionType": "dialog",
              "stopPropagation": true,
              "expression": "typeof event.data.responseResult === 'undefined' || event.data.responseResult.responseStatus !== 0",
              "dialog": {
                "title": "Failure",
                "showCloseButton": true,
                "body": [
                  {
                    "type": "alert",
                    "title": "Failed to pre-check out!",
                    "body": "Please try again later.",
                    "level": "danger",
                    "showIcon": true
                  }
                ],
                "actions": [
                  {
                    "type": "button",
                    "label": "OK",
                    "actionType": "link",
                    "link": "{{url_for('index')}}",
                    "primary": true
                  }
                ]
              }
            },
            {
              "actionType": "dialog",
              "expression": "event.data.responseResult.responseStatus === 0",
              "dialog": {
                "title": "Success",
                "showCloseButton": false,
                "body": [
                  {
                    "type": "alert",
                    "title": "Thank You!",
                    "level": "success",
                    "showIcon": true,
                    "body": "You have successfully pre-checked out. A barcode has been generated for the following check-out. Please show it to front desk by clicking the button on the main menu."
                  }
                ],
                "actions": [
                  {
                    "type": "button",
                    "label": "OK",
                    "actionType": "link",
                    "link": "{{url_for('index')}}",
                    "primary": true
                  }
                ]
              }
            }
          ]
        }
      }
    }
  ]
}
{% endblock %}